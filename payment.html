<!-- SIMPAN SEBAGAI payment.html -->
<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pembayaran - Sehat dan Sikat</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <main style="max-width: 600px; margin: 0 auto; padding: 20px; font-family: 'Inter', sans-serif;">
    <h1 style="font-family: 'Cormorant Garamond', serif; text-align: center; color: #0d1b2a;">Metode Pembayaran</h1>
    <p style="text-align: center; color: #666; margin-bottom: 30px;">Pilih cara pembayaran yang paling nyaman untuk Anda</p>
    
    <!-- Ringkasan Pesanan -->
    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
      <h3 style="color: #0d1b2a;"><i class="fas fa-receipt"></i> Ringkasan Pesanan</h3>
      <div id="order-summary" style="margin-top: 15px;">
        <!-- Diisi JavaScript -->
      </div>
    </div>
    
    <!-- Pilih Metode -->
    <h2 style="color: #0d1b2a; margin-bottom: 20px;">Pilih Metode</h2>
    
    <!-- QRIS -->
    <div id="qris-method" onclick="selectMethod('qris')" style="border: 2px solid #6c91c2; background: rgba(108, 145, 194, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 15px; cursor: pointer;">
      <div style="display: flex; align-items: center; gap: 15px;">
        <div style="width: 40px; height: 40px; background: #6c91c2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
          <i class="fas fa-qrcode"></i>
        </div>
        <div>
          <h4 style="margin: 0; color: #0d1b2a;">QRIS Digital</h4>
          <p style="margin: 5px 0; color: #666;">Bayar dengan scan QR code</p>
        </div>
        <div style="margin-left: auto; width: 24px; height: 24px; border: 2px solid #6c91c2; border-radius: 50%; background: #6c91c2; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-check" style="color: white; font-size: 12px;"></i>
        </div>
      </div>
    </div>
    
    <!-- Cash -->
    <div id="cash-method" onclick="selectMethod('cash')" style="border: 2px solid #e0e0e0; border-radius: 10px; padding: 20px; margin-bottom: 30px; cursor: pointer;">
      <div style="display: flex; align-items: center; gap: 15px;">
        <div style="width: 40px; height: 40px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
          <i class="fas fa-money-bill-wave"></i>
        </div>
        <div>
          <h4 style="margin: 0; color: #0d1b2a;">Tunai / Cash</h4>
          <p style="margin: 5px 0; color: #666;">Bayar langsung di kasir</p>
          <div style="background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 5px; font-size: 14px; margin-top: 5px;">
            <i class="fas fa-info-circle"></i> Siapkan uang pas
          </div>
        </div>
        <div style="margin-left: auto; width: 24px; height: 24px; border: 2px solid #e0e0e0; border-radius: 50%;">
          <i class="fas fa-check" style="color: white; font-size: 12px;"></i>
        </div>
      </div>
    </div>
    
    <!-- Tombol -->
    <div style="display: flex; gap: 15px; margin-top: 30px;">
      <a href="customer_form.html" style="flex: 1; text-align: center; background: #e9ecef; color: #495057; padding: 15px; border-radius: 8px; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;">
        <i class="fas fa-arrow-left"></i> Kembali
      </a>
      <button id="pay-button" onclick="processPayment()" style="flex: 1; background: #6c91c2; color: white; padding: 15px; border-radius: 8px; border: none; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
        <i class="fas fa-qrcode"></i> Lanjut ke QR Code
      </button>
    </div>
  </main>

  <script>
    let selectedMethod = 'qris';
    
    function updateSummary() {
      try {
        const cart = JSON.parse(localStorage.getItem('cart_items')) || [];
        const total = localStorage.getItem('order_total') || 0;
        const customer = JSON.parse(localStorage.getItem('customer_data')) || {};
        
        let html = `
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Total Pesanan:</span>
            <strong style="color: #6c91c2;">Rp ${parseInt(total).toLocaleString('id-ID')}</strong>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <span>Jumlah Item:</span>
            <span>${cart.reduce((sum, item) => sum + (item.qty || 0), 0)} item</span>
          </div>
        `;
        
        if (customer.customer_name) {
          html += `
            <div style="display: flex; justify-content: space-between;">
              <span>Pelanggan:</span>
              <span>${customer.customer_name} (Meja ${customer.table_number || '-'})</span>
            </div>
          `;
        }
        
        document.getElementById('order-summary').innerHTML = html;
        
      } catch (error) {
        console.error("Error:", error);
      }
    }
    
    function selectMethod(method) {
      selectedMethod = method;
      
      const qrisDiv = document.getElementById('qris-method');
      const cashDiv = document.getElementById('cash-method');
      const qrisCheck = qrisDiv.querySelector('.fa-check').parentElement;
      const cashCheck = cashDiv.querySelector('.fa-check').parentElement;
      const button = document.getElementById('pay-button');
      
      if (method === 'qris') {
        qrisDiv.style.borderColor = '#6c91c2';
        qrisDiv.style.background = 'rgba(108, 145, 194, 0.05)';
        qrisCheck.style.background = '#6c91c2';
        qrisCheck.style.borderColor = '#6c91c2';
        
        cashDiv.style.borderColor = '#e0e0e0';
        cashDiv.style.background = 'white';
        cashCheck.style.background = 'transparent';
        cashCheck.style.borderColor = '#e0e0e0';
        
        button.innerHTML = '<i class="fas fa-qrcode"></i> Lanjut ke QR Code';
        button.style.background = '#6c91c2';
      } else {
        cashDiv.style.borderColor = '#28a745';
        cashDiv.style.background = 'rgba(40, 167, 69, 0.05)';
        cashCheck.style.background = '#28a745';
        cashCheck.style.borderColor = '#28a745';
        
        qrisDiv.style.borderColor = '#e0e0e0';
        qrisDiv.style.background = 'white';
        qrisCheck.style.background = 'transparent';
        qrisCheck.style.borderColor = '#e0e0e0';
        
        button.innerHTML = '<i class="fas fa-money-bill-wave"></i> Konfirmasi Cash';
        button.style.background = '#28a745';
      }
    }
    
    function processPayment() {
      const cart = JSON.parse(localStorage.getItem('cart_items')) || [];
      const total = localStorage.getItem('order_total') || 0;
      const customer = JSON.parse(localStorage.getItem('customer_data')) || {};
      
      if (cart.length === 0) {
        alert('Keranjang kosong!');
        return;
      }
      
      if (!customer.customer_name || !customer.table_number) {
        alert('Data pelanggan tidak lengkap!');
        window.location.href = 'customer_form.html';
        return;
      }
      
      // Generate order data
      const orderId = 'ORD-' + Date.now();
      const invoiceNo = 'INV-' + Date.now();
      
      const orderData = {
        order_id: orderId,
        invoice_no: invoiceNo,
        customer_name: customer.customer_name,
        table_number: customer.table_number,
        notes: customer.notes || '',
        items: cart,
        total_price: total,
        payment_method: selectedMethod,
        status: 'pending',
        created_at: new Date().toISOString()
      };
      
      // Simpan ke localStorage
      localStorage.setItem('current_order', JSON.stringify(orderData));
      localStorage.setItem('payment_method', selectedMethod);
      
      console.log('Order:', orderData);
      
      // Redirect sesuai metode
      if (selectedMethod === 'qris') {
        window.location.href = `qris_payment.html?order_id=${orderId}`;
      } else {
        window.location.href = `thankyou.html?order_id=${orderId}&method=cash`;
      }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateSummary();
      selectMethod('qris');
    });
  </script>
</body>
</html>